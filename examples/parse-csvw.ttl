@base <http://example.org/pipeline/> .
@prefix code: <http://example.org/code/> .
@prefix p: <http://example.org/barnard59/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .

<parseCsvw> a p:Pipeline;
  p:variables [
    p:variable [
      p:name "filename";
      p:value "examples/test.csv";
    ], [
      p:name "metadata";
      p:value "examples/test.csv-metadata.json";
    ]
  ];
  p:steps [
    p:stepList ( <readFile> <parse> <serialize> )
  ].

<readFile> a p:Step;
  p:operation [
    code:link <node:fs#createReadStream>;
    a code:ecmaScript
  ];
  p:arguments ("${filename}"^^code:ecmaScriptTemplateLiteral).


<parse> a p:Step;
  p:operation [
    code:link <node:barnard59-formats#csvw.parse>;
    a code:ecmaScript
  ];
  p:arguments ( <parseMetadata> ).

<serialize> a p:Step;
  p:operation [
    code:link <file:../node_modules/barnard59-formats#ntriples.serialize> ;
    a code:ecmaScript
  ].


<parseMetadata> a p:ObjectPipeline;
  p:steps [
    p:stepList ( <readMetadata> <parseMetadataStep> )
  ].

<readMetadata> a p:Step;
  p:operation [
    code:link <node:fs#createReadStream>;
    a code:ecmaScript
  ];
  p:arguments ("${metadata}"^^code:ecmaScriptTemplateLiteral).

<parseMetadataStep> a p:Step;
  p:operation [
    code:link <node:barnard59-formats#jsonld.parse>;
    a code:ecmaScript
  ].
